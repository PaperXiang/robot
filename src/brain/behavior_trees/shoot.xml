<!-- 用于追球与高速带球测试 (无裁判机) -->

<root BTCPP_format="4" >
    <include path="./subtrees/subtree_cam_find_and_track_ball.xml" />

     <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <!-- 强制初始化状态，绕过裁判机和队友逻辑 -->
            <RunOnce>
                <Script code="is_lead=true; wait_for_opponent_kickoff=false; ball_out=false; control_state:=3" />
            </RunOnce>
            
            <ReactiveSequence>
               <!-- 视觉追踪功能 -->
               <SubTree ID="CamFindAndTrackBall" _autoremap="true" _while="control_state>=2" />
               
               <!-- 高速带球测试 -->
               <Sequence _while="control_state==3">
                    <!-- 1. 找球 -->
                    <Sequence _while="!ball_location_known">
                       <RobotFindBall vyaw_limit="1.5" />
                    </Sequence>

                    <!-- 2. 纯相对带球模式：忽略场地坐标，视觉锁定球并向前推进 -->
                    <Sequence _while="ball_location_known">
                       <Script code="kickDir:=ballYaw" /> <!-- 动态修正目标方向为球的方向 -->
                       <Chase vx_limit="1.2" vy_limit="0.5" vtheta_limit="1.5" dist="0.0" safe_dist="0.0" />
                    </Sequence>
               </Sequence>
            </ReactiveSequence>
        </Sequence>
     </BehaviorTree>
</root>
