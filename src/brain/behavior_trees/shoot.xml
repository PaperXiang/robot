<!-- 用于追球与高速带球测试 (无裁判机) -->

<root BTCPP_format="4" >
    <include path="./subtrees/subtree_cam_find_and_track_ball.xml" />
    <include path="./subtrees/subtree_find_ball.xml" />
    <include path="./subtrees/subtree_auto_standup_and_locate.xml" />

     <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <!-- 强制初始化状态，绕过裁判机和队友逻辑 -->
            <RunOnce>
                <Script code="is_lead=true; wait_for_opponent_kickoff=false; ball_out=false" />
            </RunOnce>
            
            <ReportStatus role="test_dribbler"/>
            
            <ReactiveSequence>
               <!-- 自动起身功能 -->
               <SubTree ID="AutoGetUpAndLocate" _autoremap="true" />
               
               <!-- 视觉追踪功能 -->
               <SubTree ID="CamFindAndTrackBall" _autoremap="true" />

               <!-- 高速带球测试 -->
               <Sequence>
                    <!-- 1. 找球 -->
                    <Sequence _while="!ball_location_known">
                       <RobotFindBall vyaw_limit="1.5" />
                    </Sequence>

                    <!-- 2. 高速直线带球模式：固定向前推进 -->
                    <!-- kickDir=0 表示始终朝机器人正前方带球 -->
                    <Sequence _while="ball_location_known">
                       <Script code="kickDir:=0.0" />
                       <Chase vx_limit="1.2" vy_limit="0.5" vtheta_limit="1.5" dist="0.05" safe_dist="0.3" />
                    </Sequence>
               </Sequence>
            </ReactiveSequence>
        </Sequence>
     </BehaviorTree>
</root>
